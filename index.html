<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuperDiegoClicker</title>
  <style>
    body {
      display: grid;
      place-items: center;
      height: 450px;
      /* antes 50vh */
      background: rgb(206, 204, 204);
      padding-top: 5px;
    }

    .hide-me {
      display: none;
    }

    #pantalla {
      position: relative;
      width: 265px;
      /* antes 20vh */
      height: 298px;
      /* antes 22vh */
      border: 2px solid black;
      background-color: lightblue;
    }

    #contador {
      position: absolute;
      top: 5px;
      left: 5px;
      font-family: arial, sans-serif;
      font-size: 20px;
      font-weight: bold;
    }

    #contadorExperiencia {
      position: absolute;
      top: 5px;
      right: 5px;
      font-family: arial, sans-serif;
      font-size: 20px;
      font-weight: bold;
    }

    #vidas {
      position: absolute;
      top: 5px;
      right: 5px;
      font-family: arial, sans-serif;
      font-size: 20px;
      font-weight: bold;
    }

    div#zonacliker {
      user-select: none;
    }

    .figura {
      display: inline-block;
      width: 200px;
      min-height: 180px;
      padding: 20px;
      margin: 10px;
      background-color: rgba(255, 239, 160, 0.6);
      border-radius: 3px;
      border: 2px solid rgba(232, 205, 134, 0.6);
      vertical-align: middle;

      margin: 40px 10px 10px 10px;
    }

    .figura:hover {
      background-color: rgba(255, 239, 160, 1);
      border: 2px solid rgba(232, 205, 134, 1);
      box-shadow: inset 1px 1px 100px rgba(0, 0, 0, 0.3);
    }

    .figura div {
      margin: 0 auto;
    }

    .label {
      font-family: arial, sans-serif;
      font-size: 20px;
      text-align: center;
      padding-bottom: 35px;
      font-weight: bold;
    }

    .diamante {
      position: absolute;
      border-style: solid;
      /* border-color: transparent transparent rgb(0, 229, 255) transparent; */
      border-color: transparent transparent var(--bordercoloraafter, rgb(0, 229, 255)) transparent;

      border-width: 0 25px 25px 25px;
      height: 0;
      width: 50px;
      position: relative;
      margin: 20px 0 50px 0;
    }

    .diamante:after {
      content: "";
      position: absolute;
      top: 25px;
      left: -25px;
      width: 0;
      height: 0;
      border-style: solid;
      border-color: var(--bordercoloraafter, rgb(0, 229, 255)) transparent transparent transparent;
      /* border-color: rgb(0, 229, 255) transparent transparent transparent;*/
      border-width: 70px 50px 0 50px;
    }

    .estrella {
      position: relative;
      display: block;
      width: 0;
      height: 0;
      margin: 50px;
      border-right: 50px solid transparent;
      border-bottom: 35px solid gold;
      border-left: 50px solid transparent;
      transform: rotate(35deg);
    }

    .estrella::before {
      content: "";
      position: absolute;
      border-bottom: 40px solid gold;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      top: -22px;
      left: -32px;
      transform: rotate(-35deg);
    }

    .estrella::after {
      content: "";
      position: absolute;
      border-right: 50px solid transparent;
      border-bottom: 35px solid gold;
      border-left: 50px solid transparent;
      top: 3px;
      left: -52px;
      transform: rotate(-70deg);
    }

    .escudo {
      position: relative;
      width: 80px;
      height: 100px;
      background: #3fa9f5;
      border-radius: 12px 12px 40px 40px;
      clip-path: polygon(0% 0%,
          100% 0%,
          100% 65%,
          50% 100%,
          0% 65%);
      box-shadow: inset 0 0 0 4px rgba(255, 255, 255, 0.3);
    }

    .escudo.danio {
      background: crimson;
    }


    #enemigo.nolabel {
      margin-top: 50px;
    }

    .estrella.danio {
      border-bottom-color: crimson;
    }

    .estrella.danio::before {
      border-bottom-color: crimson;
    }

    .estrella.danio::after {
      border-bottom-color: crimson;
    }

    .diamante.danio {
      border-color: transparent transparent crimson transparent !important;
    }

    .diamante.danio:after {
      border-color: crimson transparent transparent transparent !important;
    }

    /* Alien */
    .ovni {
      --color-base: #9ad9db;
      --color-cabina: rgba(255, 255, 255, 0.6);
      --color-luz: #00ffcc;

      position: relative;
      width: 120px;
      height: 40px;
      background: var(--color-base);
      border-radius: 50% / 60%;
      box-shadow: inset 0 -6px 0 rgba(0, 0, 0, 0.15);
    }

    /* Cabina superior */
    .ovni::before {
      content: "";
      position: absolute;
      top: -18px;
      left: 30px;
      width: 60px;
      height: 30px;
      background: var(--color-cabina);
      border-radius: 50%;
      box-shadow: inset 0 -4px 0 rgba(255, 255, 255, 0.4);
    }

    /* Luces inferiores */
    .ovni::after {
      content: "";
      position: absolute;
      bottom: -6px;
      left: 15px;
      width: 90px;
      height: 12px;
      background:
        radial-gradient(circle, var(--color-luz) 40%, transparent 41%) 0 0 / 18px 12px;
    }

    .ovni {
      --color-item: #9ad9db;
    }

    .ovni.danio {
      --color-item: crimson;
    }

    .ovni {
      background: var(--color-item);
    }



    .parpadeo {
      animation: blink 0.5s infinite;
      /* velocidad y repetición */
    }

    #texto {
      color: red;
      margin-top: -15px !important;
    }

    #texto.activo {
      color: transparent;
    }

    @keyframes blink {
      0% {
        background-color: red;
      }

      50% {
        background-color: yellow;
      }

      100% {
        background-color: red;
      }
    }

    #pantalla.tiendaabrierta {
      height: 30vh;
      /* el doble de su base. */
    }

    /* Cosas de la Tienda */
    .tienda {
      position: absolute;
      width: 100%;
      height: 100%;
      /* bottom: 0;
      width: 100%;
      height: 20%;
      background-color: rgba(150, 150, 150, 0.9); */
    }

    #icono-tienda {
      width: 32px;
      height: 32px;
    }

    #icono-tienda:hover {
      cursor: pointer;
      fill: orange;
    }

    .item-tienda:hover {
      cursor: pointer;
      fill: orange;
    }

    #mostrador {
      /* width: 100%; */
      height: 22%;
      background-color: rgba(150, 150, 150, 0.9);
    }

    .item-tienda {
      display: inline-block;
      width: 15%;
      height: 50px;
      margin: 10px;
    }

    .item-tienda svg:hover {
      cursor: pointer;
      fill: blueviolet;
    }

    div#mostrador {
      display: none;
    }

    div#mostrador.abierto {
      display: block;
    }
  </style>
</head>

<body>
  <div id="pantalla" class="">
    <div id="contador">5555</div>
    <div id="contadorExperiencia">3</div>
    <div id="vidas">3</div>
    <div id="zonacliker">
      <div class="figura">
        <div id="mensajes" class="label hide-me">
          <p id="texto" class="">Este texto parpadea</p>
        </div>
        <div id="enemigo" class="nolabel"></div>
      </div>
    </div>

    <!-- Tienda hide-me-->
    <div class="tienda " id="tienda">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" id="icono-tienda" viewBox="0 0 16 16">
        <path
          d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2" />
      </svg>
      <div id="mostrador" class="">
        <div id="binoculars" class="item-tienda" data-coste="20" data-poder="2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-binoculars" viewBox="0 0 16 16">
            <path
              d="M3 2.5A1.5 1.5 0 0 1 4.5 1h1A1.5 1.5 0 0 1 7 2.5V5h2V2.5A1.5 1.5 0 0 1 10.5 1h1A1.5 1.5 0 0 1 13 2.5v2.382a.5.5 0 0 0 .276.447l.895.447A1.5 1.5 0 0 1 15 7.118V14.5a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 14.5v-3a.5.5 0 0 1 .146-.354l.854-.853V9.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v.793l.854.853A.5.5 0 0 1 7 11.5v3A1.5 1.5 0 0 1 5.5 16h-3A1.5 1.5 0 0 1 1 14.5V7.118a1.5 1.5 0 0 1 .83-1.342l.894-.447A.5.5 0 0 0 3 4.882zM4.5 2a.5.5 0 0 0-.5.5V3h2v-.5a.5.5 0 0 0-.5-.5zM6 4H4v.882a1.5 1.5 0 0 1-.83 1.342l-.894.447A.5.5 0 0 0 2 7.118V13h4v-1.293l-.854-.853A.5.5 0 0 1 5 10.5v-1A1.5 1.5 0 0 1 6.5 8h3A1.5 1.5 0 0 1 11 9.5v1a.5.5 0 0 1-.146.354l-.854.853V13h4V7.118a.5.5 0 0 0-.276-.447l-.895-.447A1.5 1.5 0 0 1 12 4.882V4h-2v1.5a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5zm4-1h2v-.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm4 11h-4v.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5zm-8 0H2v.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5z" />
          </svg>
        </div>
        <div id="cloud-lightning-rain" class="item-tienda" data-coste="40" data-poder="4">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-cloud-lightning-rain"
            viewBox="0 0 16 16">
            <path
              d="M2.658 11.026a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-7.5 1.5a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m9.5 0a.5.5 0 0 1 .316.632l-.5 1.5a.5.5 0 1 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.316m-.753-8.499a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 10H13a3 3 0 0 0 .405-5.973M8.5 1a4 4 0 0 1 3.976 3.555.5.5 0 0 0 .5.445H13a2 2 0 0 1 0 4H3.5a2.5 2.5 0 1 1 .605-4.926.5.5 0 0 0 .596-.329A4 4 0 0 1 8.5 1M7.053 11.276A.5.5 0 0 1 7.5 11h1a.5.5 0 0 1 .474.658l-.28.842H9.5a.5.5 0 0 1 .39.812l-2 2.5a.5.5 0 0 1-.875-.433L7.36 14H6.5a.5.5 0 0 1-.447-.724z" />
          </svg>
        </div>
        <div id="feather" class="item-tienda" data-coste="60" data-poder="6">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-feather" viewBox="0 0 16 16">
            <path
              d="M15.807.531c-.174-.177-.41-.289-.64-.363a3.8 3.8 0 0 0-.833-.15c-.62-.049-1.394 0-2.252.175C10.365.545 8.264 1.415 6.315 3.1S3.147 6.824 2.557 8.523c-.294.847-.44 1.634-.429 2.268.005.316.05.62.154.88q.025.061.056.122A68 68 0 0 0 .08 15.198a.53.53 0 0 0 .157.72.504.504 0 0 0 .705-.16 68 68 0 0 1 2.158-3.26c.285.141.616.195.958.182.513-.02 1.098-.188 1.723-.49 1.25-.605 2.744-1.787 4.303-3.642l1.518-1.55a.53.53 0 0 0 0-.739l-.729-.744 1.311.209a.5.5 0 0 0 .443-.15l.663-.684c.663-.68 1.292-1.325 1.763-1.892.314-.378.585-.752.754-1.107.163-.345.278-.773.112-1.188a.5.5 0 0 0-.112-.172M3.733 11.62C5.385 9.374 7.24 7.215 9.309 5.394l1.21 1.234-1.171 1.196-.027.03c-1.5 1.789-2.891 2.867-3.977 3.393-.544.263-.99.378-1.324.39a1.3 1.3 0 0 1-.287-.018Zm6.769-7.22c1.31-1.028 2.7-1.914 4.172-2.6a7 7 0 0 1-.4.523c-.442.533-1.028 1.134-1.681 1.804l-.51.524zm3.346-3.357C9.594 3.147 6.045 6.8 3.149 10.678c.007-.464.121-1.086.37-1.806.533-1.535 1.65-3.415 3.455-4.976 1.807-1.561 3.746-2.36 5.31-2.68a8 8 0 0 1 1.564-.173" />
          </svg>
        </div>
        <div id="fire" class="item-tienda" data-coste="80" data-poder="8">
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-fire" viewBox="0 0 16 16">
            <path
              d="M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16m0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15" />
          </svg>
        </div>
      </div>

</body>

<script>
  class Enemigo {
    vida;
    classEnemigo;
    enemigoEl;
    arrayEnemigos;
    constructor(incVidas = 3, incEnemigo = "enemigo") {
      this.vida = incVidas;
      this.arrayEnemigos = ['diamante', 'estrella', 'escudo', 'ovni'];
      this.enemigoEl = document.getElementById(incEnemigo);
      this.classEnemigo = null;
      this.init();
    }
    init() {
      this.quitaEnemigo()
      this.setRandomEnemigo();
    }
    setRandomEnemigo() {
      const indiceAleatorio = Math.floor(Math.random() * this.arrayEnemigos.length);
      this.setEnemigoByIndice(indiceAleatorio);
    }
    setEnemigoByIndice(indice) {
      this.setEnemigoClase(this.arrayEnemigos[indice]);
    }
    quitaEnemigo() {
      this.enemigoEl.className = "nolabel";
    }
    setEnemigoClase(nuevaClase) {
      this.classEnemigo = nuevaClase;
      this.enemigoEl.classList.add(nuevaClase);
    }
  }

  class Jugador {
    subidaNivel = 1;
    subidaNivelInicial = 1;
    poderInicial = 1;
    vidasInicial = 1;
    poder;
    vidas;
    constructor(subidaNivelInicial = 1) {
      this.init(subidaNivelInicial);
    }
    init(subidaNivelInicial) {
      this.poder = this.poderInicial;
      this.vidas = this.vidasInicial;
      this.subidaNivel = subidaNivelInicial;
    }
    subirDeNivel(incremento) {
      this.poder += 1;
      this.subidaNivel += incremento;
    }
    getPoder() {
      return this.poder;
    }
    setPoder(aumento = 1) {
      this.poder = this.poder + aumento;
    }
    getVidas() {
      return this.vidas;
    }
    setVidas(aumento) {
      this.vidas = this.vidas + aumento;
    }
    getSubidaNivel() {
      return this.subidaNivel;
    }
    setSubidaNivel(aumento) {
      this.subidaNivel = this.subidaNivel + aumento;
    }
  }

  class Juego {
    clicks;
    clicksNecesariosParaGanarInicial;
    clicksNecesariosParaGanar;
    clicksNecesariosParaSubirNivelBase;
    nivelesClicks;
    instanciaJugador;
    instanciaEnemigo;
    arrayColoresEnemigos = ['rgb(0, 229, 255)', 'rgb(55, 50, 200)', 'rgb(200, 50, 200)', 'rgb(200, 50, 100)', 'rgb(238, 160, 14)'];
    constructor(clicksBase = 10, nivelesClicks = 1) {// TODO EN el futuro podría ser invocada desde fuera
      this.instanciaJugador = new Jugador();
      this.instanciaEnemigo = new Enemigo();
      this.clicksNecesariosParaGanarInicial = clicksBase * nivelesClicks;
      this.clicksNecesariosParaGanar = this.clicksNecesariosParaGanarInicial;
      this.nivelesClicks = nivelesClicks;
      this.clicksNecesariosParaSubirNivelBase = (clicksBase * 0.25);
      this.init();
    }

    init() {
      this.resetEstado();
      this.resetUITienda();
      this.renderUI();
      console.log("Juego iniciado");
    }
    getIndiceColor() {
      return this.indiceColor;
    }
    setIndiceColor(newValue) {
      return this.indiceColor = newValue;
    }
    getClicks() {
      return this.clicks;
    }
    setClicks(newValue) {
      return this.clicks = newValue;
    }
    subirDeNivel() {
      const nextPoder = this.instanciaJugador.getPoder() + 1;
      const newSubidadeNivel = this.clicksNecesariosParaSubirNivelBase * nextPoder;
      //const newSubidadeNivel = this.clicksNecesariosParaSubirNivelBase * this.instanciaJugador.getPoder();
      this.instanciaJugador.subirDeNivel(newSubidadeNivel);
      document.getElementById("contadorExperiencia").innerText = this.instanciaJugador.getSubidaNivel();
      this.mostrarMensaje("¡Nivel Up! Poder: " + this.instanciaJugador.getPoder(), 'green');
      // TODO a partir de X nivel, subir también vidar...no olvida mostrar vidas entonces. 
      this.setColorByindice();
    }
    mostrarMensaje(mensajeIncoming = "Hola", colorTexto = "red") {
      document.getElementById("mensajes").classList.remove("hide-me");
      document.getElementById("enemigo").classList.remove("nolabel");
      document.getElementById("texto").classList.add("activo");
      document.getElementById("texto").innerHTML = mensajeIncoming;
      // Guarrada, esto sería mejor con clases
      document.getElementById("texto").style.color = colorTexto;
      let parpadeo = setInterval(() => {
        document.getElementById("texto").classList.toggle("activo");
      }, 300);
      setTimeout(() => {//Por si el jugador no clicka, quitamos nosotros la clase
        document.getElementById("mensajes").classList.add("hide-me");
        document.getElementById("enemigo").classList.add("nolabel");
        //document.getElementById("mensajes").innerHTML = "";
      }, 2000);

      setTimeout(() => {
        clearInterval(parpadeo);
      }, 1000);
    }
    contarClick() {
      this.clicks = this.clicks + this.instanciaJugador.getPoder();
      document.getElementById("contador").innerText = this.clicks;
      document.getElementById("enemigo").classList.toggle("danio");
      setTimeout(() => {//Por si el jugador no clicka, quitamos nosotros la clase
        document.getElementById("enemigo").classList.remove("danio");
      }, 1);

      // Comprobamos si sube de nivel y/o gana
      if (this.getClicks() >= this.clicksNecesariosParaGanar) {
        this.mostrarMensaje("¡Has ganado! Reiniciando...");
        this.instanciaEnemigo.quitaEnemigo();
        setTimeout(() => {
          this.init();
        }, 1000);
        return;
      }
      if (this.getClicks() >= this.instanciaJugador.getSubidaNivel()) {
        this.subirDeNivel();
      }

    }
    setColorByindice() {
      const nuevoColor = this.arrayColoresEnemigos[this.getIndiceColor()];
      this.cambiarColorEnemigo(nuevoColor);
      let newIndice = this.getIndiceColor() + 1;
      if (newIndice >= this.arrayColoresEnemigos.length) {
        newIndice = 0;
      }
      this.setIndiceColor(newIndice);
    }
    // Esto debería estar en un helkper o algo..
    cambiarColorEnemigo(nuevoColor) {
      document.getElementById("enemigo").style.setProperty('--bordercoloraafter', nuevoColor)
    }
    resetEstado() {
      this.clicks = 0;
      this.indiceColor = 0;

      // Reiniciar jugador y enemigo COMPLETOS
      this.instanciaJugador = new Jugador();
      this.instanciaEnemigo = new Enemigo();

      // Valores derivados
      this.clicksNecesariosParaGanar = this.clicksNecesariosParaGanarInicial;

      // Inicializar subida de nivel correctamente
      this.instanciaJugador.init(this.clicksNecesariosParaSubirNivelBase);
    }
    renderUI() {
      document.getElementById("contador").innerText = this.clicks;
      document.getElementById("contadorExperiencia").innerText =
        this.instanciaJugador.getSubidaNivel();

      document.getElementById("vidas").innerText =
        this.instanciaJugador.getVidas();

      document.getElementById("vidas").classList.add("hide-me");
      document.getElementById("mensajes").classList.add("hide-me");

      this.instanciaEnemigo.init();

      this.setColorByindice();
    }
    resetUITienda() {
      document.getElementById("mostrador").classList.remove("abierto");
      document.getElementById("pantalla").classList.remove("tiendaabrierta");
      document.querySelectorAll('.item-tienda').forEach(elemento => {
        elemento.style.display = 'inline-block';
      });
    }
    comprarItemTienda(coste, poder) {
      console.log(`subidaNivel: ${this.getClicks()}`, `coste: ${coste}`);
      if (this.getClicks() >= coste) {
        this.instanciaJugador.setPoder(poder);
        this.mostrarMensaje(`¡Poder +${poder}!`, 'blue');
        document.getElementById("contadorExperiencia").innerText =
          this.instanciaJugador.getPoder();
        this.clicks -= coste;
        document.getElementById("contador").innerText = this.clicks;
        return true;
      } else {
        this.mostrarMensaje("¡No tienes suficiente experiencia!", 'red');
        return false;
      }
    }
  }

  const partida = new Juego(20, 4);

  document.getElementById("enemigo").addEventListener('click', () => {
    partida.contarClick();
  });
  document.getElementById("icono-tienda").addEventListener('click', () => {
    //partida.abrirCerrarTienda();
    document.getElementById("mostrador").classList.toggle("abierto");
    document.getElementById("pantalla").classList.toggle("tiendaabrierta");
  });
  document.querySelectorAll('.item-tienda').forEach(elemento => {
    elemento.addEventListener('click', () => {
      /* const poder = parseInt(elemento.dataset.poder, 10) || 0;
      partida.instanciaJugador.setPoder(poder);
      partida.mostrarMensaje(`¡Poder +${poder}!`, 'blue');
      document.getElementById("contadorExperiencia").innerText =
        partida.instanciaJugador.getPoder();
      // Ocultar el elemento clicado
      elemento.style.display = 'none'; */
      const coste = parseInt(elemento.dataset.coste, 10) || 0;
      const poder = parseInt(elemento.dataset.poder, 10) || 0;
      const comprado = partida.comprarItemTienda(coste, poder);
      if (comprado) {
        // Ocultar el elemento clicado
        elemento.style.display = 'none';
      }

    });
  });
</script>

</html>